<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Retificar Registro - Chamada Digital</title>
<style>
  /* PADRONIZA√á√ÉO COM A P√ÅGINA PRINCIPAL */
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    margin: 0;
    padding: 15px;
  }
  h2 {
    text-align: center;
    margin-bottom: 10px;
    margin-top: 50px; /* Espa√ßo para o √≠cone do menu */
  }
  .card {
    background: #fff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    max-width: 500px;
    margin: 0 auto;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
    color: #333;
  }
  select, input, button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  .btn-salvar {
    background: #5cb85c;
    color: #fff;
    font-weight: bold;
    border: none;
    cursor: pointer;
    margin-top: 25px;
    transition: background 0.3s;
  }
  .btn-salvar:active { transform: scale(0.98); }

  /* ESTILO DO MENU LATERAL (IGUAL √Ä PRINCIPAL) */
  .menu-mobile {
    cursor: pointer;
    display: inline-block;
    padding: 10px;
    position: absolute;
    top: 10px;
    left: 10px;
  }
  .bar {
    width: 25px;
    height: 3px;
    background-color: #333;
    margin: 4px 0;
    border-radius: 2px;
  }
  .side-menu {
    height: 100%;
    width: 0;
    position: fixed;
    z-index: 100;
    top: 0;
    left: 0;
    background-color: #fff;
    overflow-x: hidden;
    transition: 0.4s;
    padding-top: 60px;
    box-shadow: 2px 0 5px rgba(0,0,0,0.2);
    /* --- ADICIONE ESTAS DUAS LINHAS --- */
  overflow-y: auto;       /* Permite rolar para baixo se o menu for longo */
  display: flex;
  flex-direction: column;
}

/* Isso substitui o "link vazio" de forma autom√°tica */
.side-menu::after {
  content: "";
  min-height: 80px; /* Cria o espa√ßo vazio no final da lista */
  width: 100%;
  }
  .side-menu a {
    padding: 15px 25px;
    text-decoration: none;
    font-size: 20px;
    color: #333;
    display: block;
    border-bottom: 1px solid #eee;
  }
  .btn-voltar-menu {
    display: inline-block;
    transform: rotate(180deg);
    font-size: 30px !important;
    color: #d9534f !important;
    padding: 10px 25px !important;
    border-bottom: none !important;
  }
  #status {
    text-align: center;
    margin-top: 15px;
    font-weight: bold;
  }
</style>
</head>
<body>

<!-- √çcone do Menu -->
<div class="menu-mobile" onclick="toggleMenu()">
  <div class="bar"></div>
  <div class="bar"></div>
  <div class="bar"></div>
</div>

<!-- Painel Lateral -->
<div id="side-menu" class="side-menu">
  <a href="#" class="btn-voltar-menu" onclick="toggleMenu()">‚ûú</a> 
  <a href="https://artesvisuais.github.io/chamada_index.html">üè† Voltar para Chamada</a>
  <!--a href="chamada_edition.html">‚öôÔ∏è Retificar Dados</a-->
</div>

<h2>Retificar Registro</h2>

<div class="card">
  <label>1. Escolha a Turma:</label>
  <select id="turma">
       <option value="">-- Escolha a turma --</option>
      <option style="background-color: blue ;" value="1E">1E</option>
      <option style="background-color: blue ;" value="2G">2G</option>
      <option style="background-color: blue ;" value="3E">3E</option>
      <option style="background-color: blue ;" value="5E">5E</option>
      <option style="background-color: blue ;" value="5F">5F</option>
      <option style="background-color: blue ;" value="4A">4A</option>
      <option style="background-color: blue ;" value="4B">4B</option>
      <option style="background-color: blue ;" value="5A">5A</option>
      <option style="background-color: blue ;" value="5B">5B</option>
      <option style="background-color: blue ;" value="5C">5C</option>
      <option style="background-color: #FF00FF ;" value="5DD">5DD</option>
      <option style="background-color: #FFFF00 ;" value="EJA1">EJA1</option>
      <!--option style="background-color: #FFFF00 ;" value="2TC">2TC</option>
      <option style="background-color: #FFFF00 ;" value="3TC">3TC</option>
      <option style="background-color: #FFFF00 ;" value="4TC">4TC</option --> 
      <option style="background-color: #00FF00 ;" value="EJA2">EJA2</option>
      <!--option style="background-color: #00FF00 ;" value="2TJ">2TJ</option>
      <option style="background-color: #00FF00 ;" value="3TJ">3TJ</option>
      <option style="background-color: #00FF00 ;" value="4TJ">4TJ</option -->
      <!-- ... Adicione as outras op√ß√µes aqui ... -->
  </select>

  <label>2. Data do Erro:</label>
  <input type="date" id="data">

  <label>3. Selecione o Aluno:</label>
  <select id="selectAluno" disabled>
      <option value="">Escolha Turma e Data...</option>
  </select>

  <label>4. Novo Valor:</label>
  <select id="novoValor">
      <option value="limpar">üóëÔ∏è APAGAR REGISTRO</option>
      <option value="A">A (N√£o Letivo)</option>
      <option value="F">F (Falta)</option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
  </select>

  <button class="btn-salvar" onclick="salvarAlteracao()">Salvar Altera√ß√£o</button>
  
  <div id="status"></div>
</div>

<script>
  // COLOQUE SUA URL AQUI
  const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbyZTRtxAcPdj-qx0IC9bJ_yWELubfsPJEpUPFrqL5tYe2YPzZ3k98ReEB4kIe--ZA/exec"; 

  function toggleMenu() {
    const menu = document.getElementById("side-menu");
    menu.style.width = (menu.style.width === "250px") ? "0" : "250px";
  }

  function jsonp(url) {
    return new Promise((resolve, reject) => {
      const cb = '_cb' + Math.random().toString(36).substr(2, 9);
      window[cb] = (d) => { resolve(d); delete window[cb]; const s = document.getElementById(cb); if(s) s.remove(); };
      const s = document.createElement('script');
      s.src = url + (url.indexOf('?') === -1 ? '?' : '&') + 'callback=' + cb;
      s.id = cb;
      document.body.appendChild(s);
    });
  }

  async function atualizarListaAlunos() {
    const turma = document.getElementById("turma").value;
    const dataVal = document.getElementById("data").value;
    const selAlunos = document.getElementById("selectAluno");
    const st = document.getElementById("status");

    if (!turma || !dataVal) return;

    st.innerText = "Buscando alunos...";
    st.style.color = "orange";
    selAlunos.disabled = true;

    try {
      const partes = dataVal.split("-");
      const urlBusca = `${URL_SCRIPT}?turma=${encodeURIComponent(turma)}&dia=${parseInt(partes[2],10)}&mes=${parseInt(partes[1],10)}`;
      const resp = await jsonp(urlBusca);

      if (resp && resp.registros) {
        selAlunos.innerHTML = '<option value="">-- Selecione o Aluno --</option>';
        resp.registros.forEach(a => {
          const statusTxt = a.valor ? ` (Est√°: ${a.valor})` : " (Vazio)";
          selAlunos.innerHTML += `<option value="${a.id}">${a.nome}${statusTxt}</option>`;
        });
        selAlunos.disabled = false;
        st.innerText = "‚úÖ Lista carregada!";
        st.style.color = "green";
      } else {
        st.innerText = "‚ùå Data n√£o encontrada na planilha.";
        st.style.color = "red";
      }
    } catch (e) {
      st.innerText = "‚ùå Erro de conex√£o.";
    }
  }

  async function salvarAlteracao() {
    const turma = document.getElementById("turma").value;
    const id = document.getElementById("selectAluno").value;
    const dataVal = document.getElementById("data").value;
    const st = document.getElementById("status");

    // L√≥gica para transformar "limpar" em vazio para n√£o mexer no Apps Script
    let valorEnvio = document.getElementById("novoValor").value;
    if (valorEnvio === "limpar") {
      valorEnvio = ""; 
    }

    if (!id) return alert("Selecione um aluno!");

    st.innerText = "Enviando altera√ß√£o...";
    st.style.color = "blue";

    try {
      const partes = dataVal.split("-");
      const urlFinal = `${URL_SCRIPT}?turma=${encodeURIComponent(turma)}&id=${id}&valor=${valorEnvio}&dia=${parseInt(partes[2],10)}&mes=${parseInt(partes[1],10)}`;
      const resp = await jsonp(urlFinal);

      if (resp.ok || !resp.erro) {
        st.innerText = "‚úÖ Retificado com Sucesso!";
        st.style.color = "green";
        atualizarListaAlunos();
      } else {
        st.innerText = "‚ùå Erro: " + resp.erro;
      }
    } catch (e) {
      st.innerText = "‚ùå Falha ao salvar.";
    }
  }

  document.getElementById("turma").addEventListener("change", atualizarListaAlunos);
  document.getElementById("data").addEventListener("change", atualizarListaAlunos);

</script>
</body>
</html>



